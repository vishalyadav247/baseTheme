<section id="product-media-gallery-{{ section.id }}" class="pmg-wrapper" data-autoplay="{{ section.settings.autoplay }}"
    data-autoplay-speed="{{ section.settings.autoplay_speed }}" data-loop="{{ section.settings.loop }}"
    data-show-dots="{{ section.settings.show_dots }}" data-show-nav="{{ section.settings.show_nav }}">
    <div class="pmg">
        <!-- Thumbnails (vertical desktop / horizontal mobile) -->
        <div class="pmg-thumbs">
            <button class="pmg-thumbs-nav pmg-thumbs-prev" type="button" aria-label="Scroll thumbnails up">▲</button>
            <div class="pmg-thumbs-track">
                {% assign medias = product.media | where: "media_type", "image" %}
                {% for media in medias %}
                <button class="pmg-thumb{% if forloop.first %} is-active{% endif %}" type="button"
                    data-index="{{ forloop.index0 }}" aria-label="Thumb {{ forloop.index }}">
                    <img loading="lazy" src="{{ media | img_url: '200x' }}" width="100" height="100"
                        alt="{{ media.alt | escape }}">
                </button>
                {% endfor %}
            </div>
            <button class="pmg-thumbs-nav pmg-thumbs-next" type="button" aria-label="Scroll thumbnails down">▼</button>
        </div>

        <!-- Main Slider -->
        <div class="pmg-main">
            {% if section.settings.show_nav %}
            <button class="pmg-prev" type="button" aria-label="Previous slide">‹</button>
            {% endif %}

            <div class="pmg-track" role="region" aria-roledescription="carousel" aria-label="Product images">
                {% for media in medias %}
                <div class="pmg-slide{% if forloop.first %} is-active{% endif %}" data-index="{{ forloop.index0 }}">
                    <button class="pmg-open-lightbox" type="button" aria-label="Open image {{ forloop.index }} larger">
                        <img src="{{ media | img_url: '1024x1024' }}" srcset="
                  {{ media | img_url: '600x600' }} 600w,
                  {{ media | img_url: '900x900' }} 900w,
                  {{ media | img_url: '1200x1200' }} 1200w" sizes="(max-width: 768px) 90vw, 700px"
                            alt="{{ media.alt | escape }}" draggable="false">
                    </button>
                </div>
                {% endfor %}
            </div>

            {% if section.settings.show_nav %}
            <button class="pmg-next" type="button" aria-label="Next slide">›</button>
            {% endif %}

            <div class="pmg-ui">
                <div class="pmg-counter" aria-live="polite">
                    <span class="pmg-current">1</span>/<span class="pmg-total">{{ medias.size }}</span>
                </div>

                {% if section.settings.show_dots %}
                <div class="pmg-dots" role="tablist" aria-label="Slide dots">
                    {% for media in medias %}
                    <button role="tab" class="pmg-dot{% if forloop.first %} is-active{% endif %}" type="button"
                        data-index="{{ forloop.index0 }}" aria-label="Go to slide {{ forloop.index }}"></button>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- LIGHTBOX -->
    <div class="pmg-lightbox" hidden aria-hidden="true">
        <div class="pmg-lightbox-backdrop"></div>
        <div class="pmg-lightbox-content" role="dialog" aria-modal="true" aria-label="Image viewer">
            <button class="pmg-lightbox-close" type="button" aria-label="Close">×</button>
            <button class="pmg-lightbox-prev" type="button" aria-label="Previous">‹</button>
            <figure class="pmg-lightbox-figure">
                <img class="pmg-lightbox-img" alt="">
                <figcaption class="pmg-lightbox-counter">
                    <span class="pmg-lightbox-current">1</span>/<span class="pmg-lightbox-total">{{ medias.size
                        }}</span>
                </figcaption>
            </figure>
            <button class="pmg-lightbox-next" type="button" aria-label="Next">›</button>
        </div>
    </div>

    <script src="{{ 'product-media-gallery.js' | asset_url }}" defer></script>
    <link href="{{ 'product-media-gallery.css' | asset_url }}" rel="stylesheet">

    <script>
        document.addEventListener('shopify:section:load', (e) => {
            const root = e.target?.querySelector?.('[id^="product-media-gallery-"]');
            if (root && window.ProductMediaGallery?.init) window.ProductMediaGallery.init(root);
        });
        document.addEventListener('DOMContentLoaded', () => {
            const root = document.getElementById('product-media-gallery-{{ section.id }}');
            if (root && window.ProductMediaGallery?.init) window.ProductMediaGallery.init(root);
        });
    </script>
</section>